server {
    listen 80;
    listen [::]:80;
    server_name geoip.example.com;
    location /simple {
        add_header Country $country;
        return 200 "OK";
    }
    location /redirect {
        if ($geo_is_EA) {
            return 302 "https://geoip.example.com/EA";
        }
        if ($geo_is_EU) {
            return 302 "https://geoip.example.com/EU";
        }
        if ($geo_is_TR) {
            return 403;
        }
    }
}
server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2 on;
    server_name geoip.example.com;
    ssl_certificate cert/host-geoip.example.com.crt;
    ssl_certificate_key cert/host-geoip.example.com.key;
    location /simple {
        add_header Country $country;
        return 200 "OK";
    }
    location /redirect {
        if ($geo_is_EA) {
            return 302 "https://geoip.example.com/EA";
        }
        if ($geo_is_EU) {
            return 302 "https://geoip.example.com/EU";
        }
        if ($geo_is_TR) {
            return 403;
        }
    }
}
server {
    listen 80;
    listen [::]:80;
    server_name *.geoip.example.com;
}
server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2 on;
    server_name *.geoip.example.com;
    ssl_certificate cert/host-geoip.example.com.crt;
    ssl_certificate_key cert/host-geoip.example.com.key;
}
